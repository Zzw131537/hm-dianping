### 黑马点评相关笔记

#### 用户登录
Session 集群共享问题

服务器之间无法实现会话状态的共享

解决Session集群共享问题

1. Session拷贝(不推荐)
2. Redis缓存(推荐)

redis 代替 session 需要考虑的问题
1. 选择合适的数据结构
2. 选择合适的key,为key 设置一个业务前缀 ，方便区分，避免key冲突
3. 选择合适的存储粒度，设置合适的TTL

需要再配置一个拦截器用户刷新token过期时间

#### 店铺数据查询
缓存(cache) ,时存储数据的临时地方，读写性能较高

对于变动较小的数据可以持久化到Redis 中

数据一致性问题

主动更新

缓存击穿：
客户端请求的数据在缓存和数据库中都不存在，请求会直接打到数据库

解决方案

1.缓存空对象
2.布隆过滤

缓存雪崩: 同时间大量缓存key同时失效或者redis服务宕机,导致大量请求到达数据库，带来巨大压力

解决方案:

1. 给不同的key的TTL 设置随机值
2. 利用redis集群提高服务的可用性
3. 给缓存业务添加多级缓存

缓存击穿: 热点key问题,一个高并发访问并且缓存重建业务较复杂的key突然失效，无数请求会在瞬间个数据库带来巨大压力

互斥锁

逻辑过期

基于互斥锁解决缓存击穿

#### 优惠劵秒杀

全局唯一Id

时间戳+序列号+数据库自增

